
<!DOCTYPE html>

<html><head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <script src="lib/three.min.js"></script>
  <script src="lib/orbitcontrols.js"></script>
  <!-- fallback if no WebGL -->
  <script src="lib/projector.js"></script>
  <script src="lib/canvasrenderer.js"></script>
  <script src="lib/jquery-2.1.3.min.js"></script>
  <script src="src/csg.js"></script>
  <script src="src/threecsg.js"></script>
  <script src="src/openjscad.js"></script>
  <script src="src/formats.js"></script>

  <style>

body {
  font: 14px/20px 'Helvetica Neue Light', HelveticaNeue-Light, 'Helvetica Neue', Helvetica, Arial, sans-serif;
  max-width: 820px;
  margin: 0 auto;
  padding: 10px;
}

pre, code, textarea {
  font: 12px/20px Monaco, monospace;
  border: 1px solid #CCC;
  border-radius: 3px;
  background: #F9F9F9;
  padding: 0 3px;
  color: #555;
}
pre, textarea {
  padding: 10px;
  width: 100%;
}
textarea {
  height: 200px;
}
textarea:focus {
  outline: none;
}

canvas { cursor: move; }

  </style>
<link rel="stylesheet" href="openjscad.css" type="text/css">

<script>

var gProcessor=null;

// Show all exceptions to the user:
OpenJsCad.AlertUserOfUncaughtExceptions();

function onload()
{
  gProcessor = new OpenJsCad.Processor(document.getElementById("viewer"));
  updateSolid();  
}

function updateSolid()
{
  gProcessor.setJsCad(document.getElementById('code').value); 
  
  // Move parameter div 
  document.getElementById("parameter_container").append(document.getElementsByClassName("statusdiv")[0])
  document.getElementById("parameter_container").append(document.getElementsByClassName("parametersdiv")[0])
  
  // Add Opacity image
  $("#viewer > div.viewer")[0].style.position="absolute";
  $("#viewer > div.viewer")[0].style.top="0px";
  $("#viewer > div.viewer")[0].style.left="50%";
  $("#viewer > div.viewer")[0].style.marginLeft="-400px";
  
  $("#top_container")[0].style.width  = $("#viewer > div.viewer")[0].offsetWidth+'px';
  $("#top_container")[0].style.height = $("#viewer > div.viewer")[0].offsetHeight+'px';
  
}

function setKeyPic(input) {
  if (input.files && input.files[0]) {
    var reader = new FileReader();
    reader.onload = function (e) {
      /*$('#blah')
        .attr('src', e.target.result)
        .width(150)
        .height(200);*/
		var img = new Image;
		img.onload = function () {
			var canvas = document.getElementById("key_pic_3d");
			var ctx = document.getElementById("key_pic_3d").getContext("2d");

			//resize
			canvas.width = img.width;
			canvas.height = img.height;
			ctx.drawImage(img, 0, 0);
		};

		img.src = e.target.result;
		//ctx.drawImage(img, 0, 0);
    };
    reader.readAsDataURL(input.files[0]);
  } else {console.log("No images on file input element");}
}

</script>
<title>3D Printable Mul-T-Lock Interactive</title>  
</head>
<body onload="onload();">
  <h1>Mul-T-Lock Interactive - Solid Piece 3D Printable</h1>

<div id='top_container' style='z-index:0;margin-bottom: 0px;position:relative;'>

	<div id="viewer"></div>

</div>

<br />
Press "Generate STL" to make a file to 3D print the key model.  Set the cut depths in "Parameters" to match the key's cuts. 
<div id='parameter_container'>
</div>

  <h2>Model Code</h2>
Edit 3D source here
<br><br> 
<textarea id="code">
scale1=1;
r=241.12421755191403;
t=100;
sh_th=25;
sh_l=55;
sideA=[[-10,31],[0,31],[1,18],[2,11],[3,6],[4,3],[5,2],[6,1],[7,0],[8,0],[9,0],[10,0],[11,0],[12,0],[13,0],[14,0],[15,0],[16,0],[17,0],[18,0],[19,0],[20,0],[21,0],[22,0],[23,0],[24,0],[25,0],[26,0],[27,0],[28,0],[29,0],[30,0],[31,0],[32,0],[33,0],[34,0],[35,0],[36,0],[37,0],[38,0],[39,0],[40,0],[41,0],[42,0],[43,0],[44,0],[45,0],[46,0],[47,0],[48,0],[49,0],[50,0],[51,0],[52,0],[53,0],[54,0],[55,0],[56,0],[57,0],[58,0],[59,0],[60,0],[61,0],[62,0],[63,0],[64,0],[65,0],[66,0],[67,0],[68,0],[69,0],[70,0],[71,0],[72,0],[73,0],[74,0],[75,0],[76,0],[77,0],[78,0],[79,0],[80,0],[81,0],[82,0],[83,0],[84,0],[85,0],[86,0],[87,0],[88,0],[89,0],[90,0],[91,0],[92,0],[93,0],[94,0],[95,0],[96,0],[97,0],[98,0],[99,0],[100,0],[101,0],[102,0],[103,0],[104,0],[105,0],[106,0],[107,0],[108,0],[109,0],[110,0],[111,0],[112,0],[113,0],[114,0],[115,0],[116,0],[117,0],[118,0],[119,0],[120,0],[121,0],[122,0],[123,0],[124,0],[125,0],[126,0],[127,0],[128,0],[129,0],[130,0],[131,0],[132,0],[133,0],[134,0],[135,0],[136,0],[137,0],[138,0],[139,0],[140,0],[141,0],[142,0],[143,0],[144,0],[145,0],[146,0],[147,0],[148,0],[149,0],[150,0],[151,0],[152,0],[153,0],[154,0],[155,0],[156,0],[157,1],[158,2],[159,3],[160,4],[161,6],[162,7],[163,9],[164,11],[165,13],[166,15],[167,16],[168,18],[169,20],[170,22],[171,23],[172,25],[173,25],[174,25],[175,25],[176,25],[177,25],[178,25],[179,25],[180,25],[181,25],[182,25],[183,25],[184,25],[185,25],[186,25],[187,25],[188,25],[189,25],[190,26],[191,27],[192,28],[193,30],[194,32],[195,33],[196,35],[197,37],[198,39],[199,40],[200,42],[201,44],[202,45],[203,46],[204,46],[205,46],[206,46],[207,46],[208,46],[209,46],[210,46],[211,46],[212,46],[213,46],[214,46],[215,46],[216,46],[217,46],[218,46],[219,46],[220,46],[221,46],[222,46],[223,44],[224,38],[225,30],[226,24],[227,18],[228,12],[229,5],[230,2],[231,1],[232,1],[233,0],[234,0],[235,0],[236,0],[237,0],[238,0],[239,0],[240,0],[241,0],[242,0],[243,0],[244,0],[245,0],[246,0],[247,0],[248,0],[249,0],[250,0],[251,0],[252,0],[253,0],[254,0],[255,0],[256,0],[257,0],[258,0],[259,0],[260,0],[261,0],[262,0],[263,0],[264,0],[265,0],[266,0],[267,0],[268,0],[269,0],[270,0],[271,0],[272,0],[273,0],[274,0],[275,0],[276,0],[277,0],[278,0],[279,0],[280,1],[281,1],[282,2],[283,4],[284,8],[285,13],[286,17],[287,21],[288,27],[289,32],[290,36],[291,40],[292,46],[293,46],[294,46],[295,46],[296,46],[297,46],[298,46],[299,46],[300,46],[301,46],[302,46],[303,46],[304,46],[305,45],[306,42],[307,40],[308,37],[309,34],[310,32],[311,30],[312,27],[313,24],[314,21],[315,19],[316,17],[317,16],[318,16],[319,15],[320,15],[321,15],[322,15],[323,15],[324,15],[325,15],[326,15],[327,15],[328,15],[329,15],[330,15],[331,15],[332,15],[333,15],[334,15],[335,15],[336,15],[337,15],[338,15],[339,15],[340,15],[341,15],[342,15],[343,15],[344,15],[345,16],[346,16],[347,17],[348,25],[358,25],[358,-r],[-10,-r]];
//sideB=[[358,76],[348,76],[347,87],[346,92],[345,97],[344,99],[343,99],[342,100],[341,100],[340,100],[339,100],[338,100],[337,100],[336,100],[335,100],[334,100],[333,100],[332,100],[331,100],[330,100],[329,100],[328,100],[327,100],[326,100],[325,100],[324,100],[323,100],[322,100],[321,100],[320,100],[319,100],[318,100],[317,100],[316,100],[315,100],[314,100],[313,100],[312,100],[311,100],[310,100],[309,100],[308,100],[307,100],[306,100],[305,100],[304,100],[303,100],[302,100],[301,100],[300,100],[299,100],[298,100],[297,100],[296,100],[295,100],[294,100],[293,100],[292,100],[291,100],[290,100],[289,100],[288,100],[287,100],[286,100],[285,100],[284,100],[283,100],[282,100],[281,100],[280,100],[279,100],[278,100],[277,100],[276,100],[275,100],[274,100],[273,100],[272,100],[271,100],[270,100],[269,100],[268,100],[267,100],[266,100],[265,100],[264,100],[263,100],[262,100],[261,100],[260,100],[259,100],[258,100],[257,100],[256,100],[255,100],[254,100],[253,100],[252,100],[251,100],[250,100],[249,100],[248,100],[247,100],[246,100],[245,100],[244,100],[243,100],[242,100],[241,100],[240,100],[239,100],[238,100],[237,100],[236,100],[235,100],[234,100],[233,100],[232,100],[231,100],[230,100],[229,100],[228,100],[227,100],[226,100],[225,100],[224,100],[223,100],[222,100],[221,100],[220,100],[219,100],[218,100],[217,100],[216,100],[215,100],[214,100],[213,100],[212,100],[211,100],[210,100],[209,100],[208,100],[207,100],[206,100],[205,100],[204,100],[203,100],[202,100],[201,100],[200,100],[199,100],[198,100],[197,100],[196,100],[195,100],[194,100],[193,100],[192,99],[191,99],[190,98],[189,97],[188,95],[187,93],[186,91],[185,90],[184,88],[183,86],[182,84],[181,83],[180,81],[179,79],[178,78],[177,76],[176,75],[175,75],[174,75],[173,75],[172,75],[171,75],[170,75],[169,75],[168,75],[167,75],[166,75],[165,75],[164,75],[163,75],[162,75],[161,75],[160,75],[159,74],[158,73],[157,72],[156,71],[155,69],[154,67],[153,66],[152,64],[151,62],[150,60],[149,58],[148,57],[147,55],[146,55],[145,55],[144,55],[143,55],[142,55],[141,55],[140,55],[139,55],[138,55],[137,55],[136,55],[135,55],[134,55],[133,55],[132,55],[131,55],[130,55],[129,55],[128,55],[127,55],[126,55],[125,59],[124,65],[123,74],[122,79],[121,85],[120,91],[119,96],[118,98],[117,99],[116,100],[115,100],[114,100],[113,100],[112,100],[111,100],[110,100],[109,100],[108,100],[107,100],[106,100],[105,100],[104,100],[103,100],[102,100],[101,100],[100,100],[99,100],[98,100],[97,100],[96,100],[95,100],[94,100],[93,100],[92,100],[91,100],[90,100],[89,100],[88,100],[87,100],[86,100],[85,100],[84,100],[83,100],[82,100],[81,100],[80,100],[79,100],[78,100],[77,100],[76,100],[75,100],[74,100],[73,100],[72,100],[71,100],[70,100],[69,100],[68,99],[67,98],[66,97],[65,94],[64,89],[63,84],[62,80],[61,75],[60,70],[59,65],[58,61],[57,56],[56,55],[55,55],[54,55],[53,55],[52,55],[51,55],[50,55],[49,55],[48,55],[47,55],[46,55],[45,55],[44,55],[43,57],[42,59],[41,62],[40,64],[39,67],[38,70],[37,72],[36,75],[35,78],[34,80],[33,82],[32,83],[31,84],[30,85],[29,85],[28,85],[27,85],[26,85],[25,85],[24,85],[23,85],[22,85],[21,85],[20,85],[19,85],[18,85],[17,85],[16,85],[15,85],[14,85],[13,85],[12,85],[11,85],[10,85],[9,85],[8,85],[7,85],[6,85],[5,85],[4,85],[3,84],[2,83],[1,81],[0,69],[-10,69],[-10,r+t],[358,r+t]];
//JSON.stringify(B.map(x => [x[0],x[1]-5]))
sideB=[[358,71],[348,71],[347,82],[346,87],[345,92],[344,94],[343,94],[342,95],[341,95],[340,95],[339,95],[338,95],[337,95],[336,95],[335,95],[334,95],[333,95],[332,95],[331,95],[330,95],[329,95],[328,95],[327,95],[326,95],[325,95],[324,95],[323,95],[322,95],[321,95],[320,95],[319,95],[318,95],[317,95],[316,95],[315,95],[314,95],[313,95],[312,95],[311,95],[310,95],[309,95],[308,95],[307,95],[306,95],[305,95],[304,95],[303,95],[302,95],[301,95],[300,95],[299,95],[298,95],[297,95],[296,95],[295,95],[294,95],[293,95],[292,95],[291,95],[290,95],[289,95],[288,95],[287,95],[286,95],[285,95],[284,95],[283,95],[282,95],[281,95],[280,95],[279,95],[278,95],[277,95],[276,95],[275,95],[274,95],[273,95],[272,95],[271,95],[270,95],[269,95],[268,95],[267,95],[266,95],[265,95],[264,95],[263,95],[262,95],[261,95],[260,95],[259,95],[258,95],[257,95],[256,95],[255,95],[254,95],[253,95],[252,95],[251,95],[250,95],[249,95],[248,95],[247,95],[246,95],[245,95],[244,95],[243,95],[242,95],[241,95],[240,95],[239,95],[238,95],[237,95],[236,95],[235,95],[234,95],[233,95],[232,95],[231,95],[230,95],[229,95],[228,95],[227,95],[226,95],[225,95],[224,95],[223,95],[222,95],[221,95],[220,95],[219,95],[218,95],[217,95],[216,95],[215,95],[214,95],[213,95],[212,95],[211,95],[210,95],[209,95],[208,95],[207,95],[206,95],[205,95],[204,95],[203,95],[202,95],[201,95],[200,95],[199,95],[198,95],[197,95],[196,95],[195,95],[194,95],[193,95],[192,94],[191,94],[190,93],[189,92],[188,90],[187,88],[186,86],[185,85],[184,83],[183,81],[182,79],[181,78],[180,76],[179,74],[178,73],[177,71],[176,70],[175,70],[174,70],[173,70],[172,70],[171,70],[170,70],[169,70],[168,70],[167,70],[166,70],[165,70],[164,70],[163,70],[162,70],[161,70],[160,70],[159,69],[158,68],[157,67],[156,66],[155,64],[154,62],[153,61],[152,59],[151,57],[150,55],[149,53],[148,52],[147,50],[146,50],[145,50],[144,50],[143,50],[142,50],[141,50],[140,50],[139,50],[138,50],[137,50],[136,50],[135,50],[134,50],[133,50],[132,50],[131,50],[130,50],[129,50],[128,50],[127,50],[126,50],[125,54],[124,60],[123,69],[122,74],[121,80],[120,86],[119,91],[118,93],[117,94],[116,95],[115,95],[114,95],[113,95],[112,95],[111,95],[110,95],[109,95],[108,95],[107,95],[106,95],[105,95],[104,95],[103,95],[102,95],[101,95],[100,95],[99,95],[98,95],[97,95],[96,95],[95,95],[94,95],[93,95],[92,95],[91,95],[90,95],[89,95],[88,95],[87,95],[86,95],[85,95],[84,95],[83,95],[82,95],[81,95],[80,95],[79,95],[78,95],[77,95],[76,95],[75,95],[74,95],[73,95],[72,95],[71,95],[70,95],[69,95],[68,94],[67,93],[66,92],[65,89],[64,84],[63,79],[62,75],[61,70],[60,65],[59,60],[58,56],[57,51],[56,50],[55,50],[54,50],[53,50],[52,50],[51,50],[50,50],[49,50],[48,50],[47,50],[46,50],[45,50],[44,50],[43,52],[42,54],[41,57],[40,59],[39,62],[38,65],[37,67],[36,70],[35,73],[34,75],[33,77],[32,78],[31,79],[30,80],[29,80],[28,80],[27,80],[26,80],[25,80],[24,80],[23,80],[22,80],[21,80],[20,80],[19,80],[18,80],[17,80],[16,80],[15,80],[14,80],[13,80],[12,80],[11,80],[10,80],[9,80],[8,80],[7,80],[6,80],[5,80],[4,80],[3,79],[2,78],[1,76],[0,64],[-10,64],[-10,r+t],[358,r+t]];


blank_height_thou = 348;
blank_thick_thou  = 95;
blank_length_thou = 1580;

kw_height_pix=Math.max(...sideA.map(x=>x[0]));
kw_thick_pix=Math.max(...sideB.filter((x,i)=>i<sideB.length-2).map(x=>x[1]));


CUT_FROM_EDGE_THOU = 98;

function getParameterDefinitions() {
  return [
    { name: 'cut1i', caption: 'Cut 1 Inner:', type: 'int', default: 2},
    { name: 'cut1o', caption: 'Cut 1 Outer:', type: "choice", values: ["Z","A","B","C","D"], initial: "C"},
    { name: 'cut2i', caption: 'Cut 2 Inner:', type: 'int', default: 0},
    { name: 'cut2o', caption: 'Cut 2 Outer:', type: "choice", values: ["Z","A","B","C","D"], initial: "Z"},
    { name: 'cut3i', caption: 'Cut 3 Inner:', type: 'int', default: 1},
    { name: 'cut3o', caption: 'Cut 3 Outer:', type: "choice", values: ["A","B","C","D"], initial: "A"},
    { name: 'cut4i', caption: 'Cut 4 Inner:', type: 'int', default: 3},
    { name: 'cut4o', caption: 'Cut 4 Outer:', type: "choice", values: ["A","B","C","D"], initial: "D"},
    { name: 'cut5i', caption: 'Cut 5 Inner:', type: 'int', default: 3},
    { name: 'cut5o', caption: 'Cut 5 Outer:', type: "choice", values: ["A","B","C","D"], initial: "D"},
    { name: 'backmill', caption: 'Backmill:', type: "choice", values: ["Yes","No"], initial: "Yes"}
  ];
}


function main(params)
{
    //Parse Input Params
    interactive_blank = "C";
    if(params.cut2i===0 && params.cut2o=="Z") {interactive_blank = "S";}
    if(params.cut2i===1 && params.cut2o=="Z") {interactive_blank = "B";}
    if(params.cut2i===0 && params.cut2o=="A") {interactive_blank = "G";}
    
    var key = blank_mtl(params.backmill=="Yes",interactive_blank != "C").setColor([1,1,0])
    .subtract(cutDSD_mtl(params.cut1i,1,["AL"]))
    .subtract(cutDSD_mtl(params.cut1o,1,["AL"]))
    .subtract(cutDSD_mtl(params.cut3i,3,["AL"]))
    .subtract(cutDSD_mtl(params.cut3o,3,["AL"]))
    .subtract(cutDSD_mtl(params.cut4i,4,["AL"]))
    .subtract(cutDSD_mtl(params.cut4o,4,["AL"]))
    .subtract(cutDSD_mtl(params.cut5i,5,["AL"]))
    .subtract(cutDSD_mtl(params.cut5o,5,["AL"]))
    //.union(cutDSD_mtl(1,1))
    //.union(cutDSD_mtl(0,2))
    // .union(cutDSD_mtl(1,3))
    // .union(cutDSD_mtl("Z",4))
    // .union(cutDSD_mtl(1,5))
    // .union(CSG.cube({corner1: [0,0,0], corner2: [100,100,100]})
    .setColor([1,1,0]);
    
    if(interactive_blank == "C") {
        return key
        .subtract(cutDSD_mtl(params.cut2i,2))
        .subtract(cutDSD_mtl(params.cut2o,2))
        .setColor([1,1,0])
      .scale(0.0254);
    } else {
        return key
        .union(interactive_part(interactive_blank,["AL"]))
        .subtract(
            CSG.cube(
                {
                    corner1: [0,-964-250,0], 
                    corner2: [200,0,blank_height_thou]
                }
            )
            .rotateZ(Math.atan(-22.6/775.3)*180/Math.PI)
            .translate([blank_thick_thou,blank_length_thou,0])
        )
        .setColor([1,1,0])
        .scale(0.0254);
    }
}

function cutDSD_mtl(depth,space,positions=["AL","BL"]) {
    depths=[114.0,94.4,74.8,55.2,35.4,15.7];
    spaces=[0,964.2,775.3,586.4,397.5,208.6];
    
    outer=false;
    if(depth=="Z") {depth=0; outer = true;}
    if(depth=="A") {depth=1; outer = true;}
    if(depth=="B") {depth=2; outer = true;}
    if(depth=="C") {depth=3; outer = true;}
    if(depth=="D") {depth=4; outer = true;}

    return cut_mtl(depths[depth],spaces[space],outer,positions);
}
function cut_mtl(depth,space,outer,positions=["AL","BL"]) {
    var cutter_inn = CAG.fromPoints([[0,0],[0,15],[65,90],[1000,90],[1000,0]])
    .rotateZ(-90)
    .rotateExtrude({resolution: 36})
    .rotateY(90)

    var cutter_out = CAG.fromPoints([[0,-17],[0,10],[65,88],[1000,88],[1000,-42],[25,-42]])
    .translate([0,50,0])
    .rotateZ(-90)
    .rotateExtrude({resolution: 36})
    .rotateY(90)

    var cutter = outer ? cutter_out : cutter_inn; 
    
    var cuts = CSG.cube({corner1: [0,0,0], corner2: [1,1,1]});

    if(positions.includes("AL")) {
        cuts = cuts.union(
            cutter.translate([
                blank_thick_thou - depth,
                blank_length_thou - space,
                blank_height_thou - CUT_FROM_EDGE_THOU
            ])
        );
    }
    if(positions.includes("AR")) {
        cuts = cuts.union(
            cutter.translate([
                blank_thick_thou - depth,
                blank_length_thou - space,
                CUT_FROM_EDGE_THOU
            ])
        );
    }
    if(positions.includes("BL")) {
        cuts = cuts.union(
            cutter
            .rotateY(180)
            .translate([
                depth,
                blank_length_thou - space,
                CUT_FROM_EDGE_THOU
            ])
        );
    }
    if(positions.includes("BR")) {
        cuts = cuts.union(
            cutter
            .rotateY(180)
            .translate([
                depth,
                blank_length_thou - space,
                blank_height_thou - CUT_FROM_EDGE_THOU
            ])
        );
    }
        
    return cuts;
}

function wheel(which="CW-14MC") {
    if(which=="CW-14MC")
        return CAG.fromPoints([[100,-123],[0,-23],[0,23],[100,123]]);
    if(which=="CW-1012")
        return CAG.fromPoints([[200,-200],[0,-7.5],[0,7.5],[200,200]]);
}

function interactive_part(colour, positions=["AL","BL"], deployed=true) {
    part = CSG.cylinder({
        start: [0,0,0], 
        end: [0,0,blank_thick_thou], 
        radius: 50, 
        resolution: 64 
    })
    .rotateY(90)
    .translate([19.6,blank_length_thou - 775.3,0])
    .subtract(
        cutDSD_mtl(colour == "B" ? 1 : 0, 2, ["BL"])
        .translate([0,0,-CUT_FROM_EDGE_THOU])
    )
    .subtract(
        cutDSD_mtl(colour == "G" ? 'A' : 'Z', 2, ["BL"])
        .translate([0,0,-CUT_FROM_EDGE_THOU])
    )
    .setColor(
        colour == "B" ? [0.1,0.1,0.1] : (
            colour == "S" ? [0.9,0.9,0.9] : [0.8,0.8,0]
        )
    )
    
    parts = CSG.cube({corner1: [0,0,0], corner2: [1,1,1]});
    
    if(positions.includes("AL")) {
        parts = parts.union(
            part.translate([0,0,blank_height_thou - CUT_FROM_EDGE_THOU])
            .mirroredX().translate([blank_thick_thou,0,0])
        );
    }
    if(positions.includes("BL")) {
        parts = parts.union(
            part.translate([0,0,CUT_FROM_EDGE_THOU])
        );
    }
    if(positions.includes("AR")) {
        parts = parts.union(
            part.translate([0,0,blank_height_thou - CUT_FROM_EDGE_THOU])
        );
    }
    if(positions.includes("BR")) {
        parts = parts.union(
            part.translate([0,0,CUT_FROM_EDGE_THOU])
            .mirroredX()
            .translate([blank_thick_thou,0,0])
        );
    }
    return parts;
}

function blank_mtl(backmill=false,interactive=true) {
    var end = CAG.fromPoints([[-134,100],[124,100],[50,0],[-50,0]])
    .extrude({offset: [0,0,250]})
    .rotateY(90)
    .rotateZ(-55)
    .translate([15,blank_length_thou,0])
    .union(
        CSG.cube({corner1: [0,0,0], corner2: [200,200,200]})
        .rotateX(193)
        .translate([-50,blank_length_thou,-50])
    )
    
    return slug_mtl()
    .subtract(milling(backmill)
        .translate([0,interactive ? 1040 : 320,0])
        .union(
            CSG.cylinder({
                start: [0,0,-200], 
                end: [0,0,200], 
                radius: 50, 
                resolution: 64 
            })
            .rotateY(90)
            .translate([0,blank_length_thou - 775.3,CUT_FROM_EDGE_THOU])    
            .union(
                CSG.cylinder({
                    start: [0,0,-200], 
                    end: [0,0,200], 
                    radius: 50, 
                    resolution: 64 
                })
                .rotateY(90)
                .translate([0,blank_length_thou - 775.3,blank_height_thou - CUT_FROM_EDGE_THOU])
            )
            .translate([0,0,1000])
        )
    ).subtract(
        end.translate([0,0,90])
    ).subtract(
        end.rotateY(180)
        .translate([blank_thick_thou,0,0])
        .translate([0,0,blank_height_thou - 90])
    );
}
function slug_mtl() {
    return head().union(blade_mtl());
}
function blade_mtl() {
    return CAG.fromPoints(
          [[0,0],[0,blank_height_thou],[blank_length_thou,blank_height_thou],
          [blank_length_thou,0]]
          )
          .extrude({offset: [0,0,blank_thick_thou]})
          .rotateX(90).rotateY(0).rotateZ(90)
          ;
}
function head() {
    hx=800;
    hy=400;
    return CAG.fromPoints(
        [[0,0],[0,hx],[hx-sh_l,hx],[hx-sh_l,hy+blank_height_thou/2+sh_th],
        [hx,hy+blank_height_thou/2+sh_th],[hx,hy-blank_height_thou/2-sh_th],
        [hx-sh_l,hy-blank_height_thou/2-sh_th],[hx-sh_l,0]])
        .extrude({offset: [0,0,blank_thick_thou]})
        .rotateX(90).rotateY(0).rotateZ(90)
        .translate([0,-hx,-hy+blank_height_thou/2])
        ;
}
function milling(backmill=false,interactive=true) {
  var mill = B().extrude({offset: [0,0,blank_length_thou+1]})
    .rotateX(90).rotateY(-90).rotateZ(180)
    
    .translate([0,0,0])
    .union(
        A()
        .extrude({offset: [0,0,blank_length_thou+1]})
        .rotateX(90).rotateY(-90).rotateZ(180)
        .translate([0,0,0])
    );
    if(backmill) {
        return mill.union(backmillingA()).union(backmillingB());
    }
    return mill;
}
function backmillingA() {
    return A().scale(1/scale1)
        .mirroredY()
        .rotateZ(90)
        .translate(r,0,0)
        .rotateExtrude
        ({
            angle: 40, 
        })
        .mirroredX()
        .rotateZ(-40)
        .translate([-r,0,-r])
        .scale(scale1)
}
function backmillingB() {
    return B()
        .rotateZ(90)
        .translate([r+blank_thick_thou,0,0])
        .rotateExtrude
        ({
            angle: 40, 
        })
        .rotateZ(40)
        .translate([r+blank_thick_thou,0,0])
}

function A() {
  return CAG.fromPoints(sideA).scale(scale1);
}
function B() {
  return CAG.fromPoints(sideB).scale(scale1);
}

</textarea><br>
<input type="submit" value="Update" onclick="updateSolid(); return false;">
<br>
This code will also work in any other JSCAD renderer such as <a href="http://openjscad.org/">http://openjscad.org/</a>.

</body>
</html>
